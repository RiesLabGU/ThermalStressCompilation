---
title: "Hypotheses plots"
output: html_notebook
---

Performance. We calculated performance as a function of development rate and surivival. 
We expect development rate to have steeper slopes at tropical than at temperate latitudes due to "higher is better".

```{r}
# Gaussian --------------------------------------------------------------------------------------
# a is the height of the curve
# b is the position of the center of the peak
# c is the standard deviation
Gaus <- function(x, a, b, c) {
  output <- a * exp(1)^(-0.5 * (abs(x - b)/ c)^2)
  print(output)
}

```

Anna's plots

A. Survival is fixed, dr is adaptive with latitude
```{r}
temperature <- seq(10,40, by = 1)
A_survival <- c(0, 0.25, 0.5, 0.75, 0.89,
                1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                0.89, 0.75,0.5,0.25,0,NA)
A_drGaus <- Gaus(temperature, 1, 30, 3)
# This code is get the values of the vector above, but separated by commas, so the curve can be edited:
paste(as.character(A_drGaus), sep="' '", collapse=", ")
A_drtrop <- c(NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, 
              NA, NA, NA, NA,
              0.00386592013947281, 0.0111089965382423, 0.0285655007845504, 0.0657285286165305, 0.135335283236613,               0.249352208777296, 0.411112290507187, 0.606530659712633, 0.800737402916808, 0.945959468906766,
              1, 0.945959468906766, 0.800737402916808, 0.606530659712633, 0, 
              NA, NA)

A_drtemp <- c(NA, NA, NA, NA, NA, 
              NA, NA, NA, NA, NA,
              0.00386592013947281, 0.0111089965382423, 0.0285655007845504, 0.0657285286165305, 0.135335283236613,               0.249352208777296, 0.411112290507187, 0.606530659712633, 0.800737402916808, 0.945959468906766, 
              1, 0.945959468906766, 0.800737402916808, 0.606530659712633, 0, 
              
              NA, NA, NA, NA, NA, NA)

FigureA <- tibble(temperature = temperature, 
                  survival = A_survival, 
                  tropical = A_drtrop, 
                  temperate = A_drtemp, 
                  P_tropical = survival * tropical, 
                  P_temperate = survival * temperate)


ggplot(FigureA, aes(x = temperature, y = survival))+
  geom_line(linetype = 2, size = 2)+
  #geom_line(aes(x = temperature, y = tropical, col = "tropical"))+
  geom_line(aes(x = temperature, y = P_temperate), col = "grey",  size = 2)+
  geom_line(aes(x = temperature, y = temperate), col = "black", linetype = 3, size = 2)+
  scale_color_viridis_d()+
  theme_cowplot()
```

```{r}
ggplot(FigureA, aes(x = temperature, y = survival))+
  geom_line(linetype = 2, size = 2)+
  
  geom_line(aes(x = temperature, y = P_tropical), col = "grey", size = 2)+
  geom_line(aes(x = temperature, y = tropical), col = "black", size = 2, linetype = 3)+
  scale_color_viridis_d()+
  theme_cowplot()
```

```{r}
# Figure B
B_drGaus <- Gaus(temperature, 1, 30, 7)
B_dr <- c( NA,0.0168798841487899, 0.0251304889852744, 0.036658041953378, 0.0523931410698256, 0.0733696513683829, 0.100668899772898, 0.135335283236613, 0.178263979585048, 0.230066298993809, 0.290923807046148, 0.360447788597821, 0.437564737700269, 0.520450121020702, 0.606530659712633, 0.692569324205198, 0.774837428883249, 0.849365816568312, 0.912254076828545, 0.960005441285478, 0.989847803378734, 1,0.989847803378734, 0.960005441285478,0.90, 0.800737402916808, 0.606530659712633, 0, 
              NA, NA, NA)
B_temperate <- c(0, 0.25, 0.5, 0.75, 0.89,
                1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                1, 
                0.89, 0.75,0.5,0.25,0,NA,
                NA, NA, NA, NA, NA, NA, NA, NA, NA)
B_tropical <- c(NA, NA, NA, NA, NA, NA, 
                NA, NA, NA,NA, 0, 0.25, 0.5, 0.75, 0.89,
                1, 1, 1, 1, 1, 1,1, 1, 1, 1, 1,
                0.89, 0.75,0.5,0.25,0)
FigureB <- tibble(temperature = temperature, 
                  dr= B_dr, 
                  temperate = B_temperate, 
                  tropical = B_tropical, 
                  P_temperate = dr * temperate, 
                  P_tropical = dr * tropical)

ggplot(FigureB, aes(x = temperature, y = dr))+
  geom_line(aes(x = temperature, y = P_tropical), col = "grey", size = 2)+
  geom_line(aes(x = temperature, y = tropical), col = "black", size = 2, linetype = 2)+
  geom_line(linetype = 3, size = 2)+
  
  
  scale_color_viridis_d()+
  theme_cowplot()
```

```{r}
ggplot(FigureB, aes(x = temperature, y = dr))+
  geom_line(aes(x = temperature, y = P_temperate), col = "grey", size = 2)+
  geom_line(aes(x = temperature, y = temperate), col = "black", size = 2, linetype = 2)+
  geom_line(linetype = 3, size = 2)+
  scale_color_viridis_d()+
  theme_cowplot()
```
Figure C
```{r}
dr_temperateC <- c(NA, NA, NA, NA,
              0.00386592013947281, 0.0111089965382423, 0.0285655007845504, 0.0657285286165305, 0.135335283236613,               0.249352208777296, 0.411112290507187, 0.606530659712633, 0.800737402916808, 0.945959468906766, 
              1, 0.945959468906766, 0.800737402916808, 0.606530659712633, 0, 
              NA, NA, NA, NA,NA,NA,
              NA, NA, NA, NA, NA, NA)

FigureC <- tibble(temperature = temperature, 
                  dr_tropical = FigureA$tropical,
                  dr_temperate = dr_temperateC,
                  su_tropical = FigureB$tropical,
                  su_temperate = FigureB$temperate, 
                  P_tropical = dr_tropical * su_tropical,
                  P_temperate = dr_temperate * su_temperate)

ggplot(FigureC, aes(x = temperature, y = dr_temperate))+
  geom_line(aes(x = temperature, y = P_temperate), col = "grey", size = 2)+
  geom_line(aes(x = temperature, y = su_temperate), col = "black", size = 2, linetype = 2)+
  geom_line(linetype = 3, size = 2)+
  scale_color_viridis_d()+
  theme_cowplot()


```

```{r}
FigureD <- tibble(temperature = temperature, 
                  dr = FigureB$dr, 
                  survival = FigureA$survival, 
                  P = dr * survival)
ggplot(FigureD, aes(x = temperature, y = dr))+
  geom_line(aes(x = temperature, y = P), col = "grey", size = 2)+
  geom_line(aes(x = temperature, y = survival), col = "black", size = 2, linetype = 2)+
  geom_line(linetype = 3, size = 2)+
  scale_color_viridis_d()+
  theme_cowplot()
```


```{r}

ggplot(FigureC, aes(x = temperature, y = dr_tropical))+
  geom_line(aes(x = temperature, y = P_tropical), col = "grey", size = 2)+
  geom_line(aes(x = temperature, y = su_tropical), col = "black", size = 2, linetype = 2)+
  geom_line(linetype = 3, size = 2)+
  scale_color_viridis_d()+
  theme_cowplot()

```


Is there a trade-off between cold and heat tolerance?

```{r}
Tolerance <- tibble(cold= rnorm(50, mean = 12, sd = 2), 
                    hot1 = rnorm(50, mean = 2, sd = 2), 
                    hot2 = (cold/2)-3,
                    hot3 = 10 -(cold/2))

ggplot(Tolerance, aes(x = hot1, y = cold)) +
  geom_point(size = 2)+
  theme_cowplot()+
  geom_hline(yintercept = 12)+
  ylim(0,20)+
  xlim(0,20)+
  ylab("cold tolerance")+
  xlab("heat tolerance")
  
  
  
```

```{r}
ggplot(Tolerance, aes(x = hot2, y = cold)) +
  geom_point(size = 2)+
  theme_cowplot()+
  geom_hline(yintercept = 12)+
  ylim(0,20)+
  xlim(0,20)+
  ylab("cold tolerance")+
  xlab("heat tolerance")
```



```{r}
ggplot(Tolerance, aes(x = hot3, y = cold)) +
  geom_point(size = 2)+
  theme_cowplot()+
  geom_hline(yintercept = 12)+
  ylim(0,20)+
  xlim(0,20)+
  ylab("cold tolerance")+
  xlab("heat tolerance")
```



Survival curve bounds development curve. However, Sopt is often smaller than Dopt. What factors influence variation in the distance between Dopt and Sopt?

```{r}
di <- tibble(Temperature = seq(10,34, by = 1),
             survival = c(0,0.1, 0.5, 0.75, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0.75,0.5,0.1,0), 
             dr = Gaus(Temperature, 1, 30, 3), 
             drTrop = Gaus(Temperature, 1, 33, 6),
             performance = dr * survival, 
             dr2 = Gaus(Temperature, 1, 25, 5),
             dr2t = ifelse(Temperature > 14 & Temperature < 29, dr2, NA),
             performance2 = dr2 * survival,
             performance2t = dr2t *survival,
             performance3 = drTrop * survival)
Popt <-   filter(di, performance == max(performance, na.rm = T))[["Temperature"]]
maxP <-   filter(di, performance == max(performance, na.rm = T))[["performance"]]
Plower <- filter(di, performance >= maxP/2)[1, 1][[1]]
Pupper <- max(filter(di, performance <= maxP/2)[, 1])

triangle <- data.frame(group = c(1,1,1), polygon.x = c(26.5,Popt,31.64), polygon.y = c(0.5,maxP,0.5))


ggplot(di, aes(x = Temperature, y = survival))+
  geom_line(col = "black", size = 2, linetype = 2)+
  geom_line(aes(x = Temperature, y = performance),size = 2, col = "grey")+
  geom_line(aes(x = Temperature, y = dr), col = "black", size = 2, linetype = 3)+
  geom_hline(yintercept =  0.5, linetype = 2)+
  #geom_area(mapping = aes(Temperature = ifelse(Temperature >26.5 & Temperature< 31.64 & performance > 0.5, Temperature, 0)), fill = "red") +
  #geom_polygon(data = triangle, aes(x = polygon.x, y = polygon.y, group = group), alpha = 0.3)+
  ylab("performance, survival, dr")+
  theme_cowplot()
```



```{r}
ggplot(di, aes(x = Temperature, y = survival))+
  geom_line(col = "black", size = 2, linetype = 2)+
  
  geom_line(aes(x = Temperature, y = performance2t), size = 2, col = "grey")+
  geom_line(aes(x = Temperature, y = dr2t), col = "black", size = 2, linetype = 3)+
  geom_hline(yintercept =  0.5, linetype = 2)+
  #geom_area(mapping = aes(Temperature = ifelse(Temperature >26.5 & Temperature< 31.64 & performance > 0.5, Temperature, 0)), fill = "red") +
  #geom_polygon(data = triangle, aes(x = polygon.x, y = polygon.y, group = group), alpha = 0.3)+
  ylab("performance, survival, dr")+
  theme_cowplot()
```











```{r}
Popt <-   filter(di, performance2 == max(performance2, na.rm = T))[["Temperature"]]
maxP <-   filter(di, performance2 == max(performance2, na.rm = T))[["performance2"]]
Plower <- filter(di, performance2 >= maxP/2)[1, 1][[1]]
Pupper <- max(filter(di, performance2 <= maxP/2)[, 1])

triangle2 <- data.frame(group = c(1,1,1), polygon.x = c(28.3,Popt,31.9), polygon.y = c(0.5,maxP,0.5))

ggplot(di, aes(x = Temperature, y = survival))+
  geom_line(col = "gray")+
  geom_line(aes(x = Temperature, y = dr2), col = "grey")+
  geom_line(aes(x = Temperature, y = performance2))+
  geom_hline(yintercept =  0.5, linetype = 2)+
  #geom_area(mapping = aes(Temperature = ifelse(Temperature >26.5 & Temperature< 31.64 & performance2 > 0.5, Temperature, 0)), fill = "red") +
  #geom_polygon(data = triangle2, aes(x = polygon.x, y = polygon.y, group = group), alpha = 0.3)+
  ylab("performance, survival, dr")+
  theme_cowplot()
```

```{r}
ggplot(di, aes(x = Temperature, y = survival))+
  geom_line(linetype = 2, size = 2)+
  
  geom_line(aes(x = Temperature, y = performance3), col = "grey", size = 2)+
  geom_line(aes(x = Temperature, y = drTrop), linetype = 3, size = 2)+
  geom_hline(yintercept =  0.5, linetype = 2)+
  #geom_area(mapping = aes(Temperature = ifelse(Temperature >26.5 & Temperature< 31.64 & performance2 > 0.5, Temperature, 0)), fill = "red") +
  #geom_polygon(data = triangle2, aes(x = polygon.x, y = polygon.y, group = group), alpha = 0.3)+
  ylab("performance, survival, dr")+
  theme_cowplot()
```





```{r}
survival <- tibble(Temperature = c(12,13,14,  15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26,27,28,29, 31,32,33,34,35,36,37,38,39), 
            Stemperate =  c(0,0.1, 0.5, 0.75, 1, 1,   1, 1,   1, 1,   1, 1, 1, 1, 1, 1, 1, 1, 0.75,0.5,0.1,0,NA,NA,NA, NA,NA), 
            Stropical =    c(NA,NA,NA,0, 0.1, 0.5, 0.75, 1,   1, 1,   1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0.75,0.5,0.1,0, NA, NA), 
            Ss =    c(NA,NA, NA,NA,NA, NA, NA, NA, NA,0, 0.1, 0.5, 0.75,  1, 1, 1, 1, 1, 1, 1, 1, 0.75,0.5,0.1,0, NA,NA), 
            Short =    Gaus(Temperature, 1, 25, 5)) 

ggplot(survival, aes(x = Temperature, y = Stemperate))+
  geom_line(linetype = 2)+
  geom_line(data = survival, mapping= aes(x = Temperature, y = Stropical),linetype = 4)+
  geom_line(data = survival, mapping= aes(x = Temperature, y = Short), linetype = 3)+
  geom_line(data = survival, mapping= aes(x = Temperature, y = Ss), linetype = 1)+
  theme_cowplot()

```

For tropical (solid line), the valid development range is from 17 to 36. For temperate (dashed line), the valid development range is from 14 to 33


```{r}


Gaus <- function(x, a, b, c) {
  output <- a * exp(1)^(-0.5 * (abs(x - b)/ c)^2)
  print(output)
}

x <- seq(10,40,by = 1)
tropical <- tibble(Temperature = c(10,  14,  15, 20, 25, 33,32,33,37), 
                   survival =     c(0, 0.5, 0.75, 1, 1,  1, 0.75,0.5,0 )) 
# Choose the mean as 2.5 and standard deviation as 2. 

first <- tibble(ratetemp = Gaus(x, 1, 30, 5), 
                temp = x,
                ratetrop1 = Gaus(x, 1, 33, 5),
                ratetrop = ifelse(temp > 32, (ratetemp + ratetrop1 + ratetemp)/3, ratetrop1))

ggplot(first, aes(x = temp, y = ratetemp))+
  geom_line()+
  geom_line(aes(x = temp, y = ratetrop1), col = "orange")
```


```{r}
frankencurves <- tibble(Temperature = first$temp,
                        Dtemperate = ifelse(Temperature < 34, first$ratetemp, NA), 
                        Dtropical = ifelse(Temperature < 37, first$ratetrop1, NA))




```

```{r}
tropiOpt <- filter(frankencurves, Dtropical == max(Dtropical, na.rm = T))[[1,1]]
tropiRate <- filter(frankencurves, Dtropical == max(Dtropical, na.rm = T))[[1,3]]
tempeOpt <- filter(frankencurves, Dtemperate == max(Dtemperate, na.rm = T))[[1,1]]
tempeRate <- filter(frankencurves, Dtemperate == max(Dtemperate, na.rm = T))[[1,2]]
ggplot(frankencurves, aes(x = Temperature, y = Dtemperate))+
  geom_line(linetype = 2)+
  geom_line(data = frankencurves, mapping = aes(x = Temperature, y = Dtropical), linetype = 1)+
  #geom_line(data = frankencurves, mapping = aes(x = Temperature, y = temperate), linetype = 4, col = grey, alpha = 0.5)+
  #geom_line(data = frankencurves, mapping = aes(x = Temperature, y = tropical), linetype = 3, col = grey, alpha = 0.5)+
  #geom_line(data = first, mapping = aes(x = temp, y = ratetrop1), linetype = 3)+
  #geom_segment(x = tropiOpt, xend = tropiOpt, y = 0, yend = tropiRate)+
  #geom_segment(x = tempeOpt, xend = tempeOpt, y = 0, yend = tempeRate, linetype = 2)+
  theme_cowplot()+
  ylab("Standardized development rate")+
  xlab("Temperature")


```


```{r}


Temperature <-  seq(from = 0, to = 40, by = 1) 

hypot <- merge(survival, frankencurves, by = "Temperature")

hyp <- tibble(temp = hypot$Temperature, 
              S1 = hypot$Stropical, 
              S2 = hypot$Stemperate, 
              SS = hypot$Short,
              Ss = hypot$Ss,
              D1 = ifelse(is.na(S1), NA, ifelse(S1 > 0, hypot$Dtropical, NA)),
              D2 = ifelse(is.na(S2), NA, ifelse(S2 > 0, hypot$Dtemperate, NA)),
              
              P1 = S1 * D1, 
              P2 = S2 * D2, 
              P1s = SS * D1, 
              P2s = SS * D2, 
              P1ss = Ss *D1)
  
  
  
ggplot(hyp, aes(x = temp, y = S1))+
  geom_line(col = "grey")+
  geom_line(aes(x = temp, y = D1), linetype = 1, col = "grey")+
  geom_line(aes(x = temp, y = P1), linetype = 1, col = "black")+
  geom_line(aes(x = temp, y = D2), linetype = 2, col = "grey")+
  geom_line(aes(x = temp, y = P2), linetype = 2, col = "black")+
  geom_line(aes(x = temp, y = S2), linetype = 2, col = "grey")+
  #geom_line(aes(x = temp, y = S2), linetype = 1, col = "red")+
  #geom_line(aes(x = temp, y = D2), linetype = 1, col = "orange")+
  #geom_line(aes(x = temp, y = P2), linetype = 1, col = "orange")+
  theme_cowplot()
  


```

```{r}
ggplot(hyp, aes(x = temp, y = S2))+
  geom_line(col = "grey", linetype = 2)+
  geom_line(aes(x = temp, y = D2), linetype = 2, col = "grey")+
  geom_line(aes(x = temp, y = P2), linetype = 2, col = "black")+
  
  theme_cowplot()
```


```{r}
ggplot(hyp, aes(x = temp, y = Ss))+
  geom_line(col = "grey")+
  geom_line(aes(x = temp, y = D1), linetype = 1, col = "grey")+
  #geom_line(aes(x = temp, y = P1s), linetype = 2, col = "black")+
  geom_line(aes(x = temp, y = P1ss), linetype = 1, col = "black")+
  theme_cowplot()
```




```{r}
ggplot(hyp, aes(x = temp, y = S1))+
  geom_line(col = "grey")+
  geom_line(aes(x = temp, y = D1), linetype = 1, col = "grey")+
  #geom_line(aes(x = temp, y = P1s), linetype = 2, col = "black")+
  geom_line(aes(x = temp, y = P1), linetype = 1, col = "black")+
  theme_cowplot()

```

Is there a trade-off between cold and heat tolerance?
Cold tolerance = topt - 

```{r}

```

